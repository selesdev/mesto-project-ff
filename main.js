(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"27cc1487-2c2f-4ec3-87c8-07368c48e287","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: "+e.status)}function o(o){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/users/me/avatar",{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)}var n=document.querySelector("#card-template").content;function r(o,r,c){c.delCard;var a=c.handleImageClick,u=c.likes,i=void 0===u?[]:u,l=c.ownerId,s=c.cardId,d=c.currentUserId,p=n.querySelector(".card").cloneNode(!0),_=p.querySelector(".card__image"),f=p.querySelector(".card__title"),m=p.querySelector(".card__delete-button"),y=p.querySelector(".card__like-button"),v=document.createElement("span");v.classList.add("card__like-counter"),y.after(v),v.classList.add("card__like-counter");var h=document.createElement("div");return h.classList.add("card__like-container"),h.appendChild(y),h.appendChild(v),p.querySelector(".card__description").appendChild(h),_.src=r,_.alt=o,f.textContent=o,v.textContent=i.length,i.some((function(e){return e._id===d}))&&y.classList.add("card__like-button_is-active"),y.addEventListener("click",(function(){var o=y.classList.contains("card__like-button_is-active"),n=o?function(o){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards/likes/"+o,{method:"DELETE",headers:e.headers}).then(t)}(s):function(o){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards/likes/"+o,{method:"PUT",headers:e.headers}).then(t)}(s);n.then((function(e){v.textContent=e.likes.length,o?y.classList.remove("card__like-button_is-active"):y.classList.add("card__like-button_is-active")})).catch(console.log)})),_.addEventListener("click",(function(){a(r,o)})),l===d?m.addEventListener("click",(function(){(function(o){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards/"+o,{method:"DELETE",headers:e.headers}).then(t)})(s).then((function(){return p.remove()})).catch(console.log)})):m.remove(),p}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&a(t)}}function i(e,t){var o=e.querySelector(".".concat(t.classList[1],"-error"));o&&(t.classList.remove("popup__input_type_error"),o.textContent="",o.classList.remove("popup__error_visible"))}function l(e,t){var o=e.every((function(e){return e.validity.valid}));t.disabled=!o,t.classList.toggle("popup__button_disabled",!o)}function s(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");t.forEach((function(t){t.setCustomValidity(""),i(e,t)})),o.disabled=!0,o.classList.add("popup__button_disabled")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}document.querySelector("#card-template").content;var p=document.querySelector(".content").querySelector(".places__list"),_=(document.querySelector(".card__like-button"),document.querySelector(".popup_type_edit")),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".popup__image"),S=document.querySelector(".popup__caption"),b=document.forms["new-place"],q=document.querySelector(".popup__input_type_card-name"),g=document.querySelector(".popup__input_type_url"),k=document.querySelector(".popup__form"),C=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),E=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_avatar"),I=A.querySelector(".popup__form"),T=A.querySelector(".popup__input_type_avatar"),j=document.querySelector(".profile__image"),O=k.querySelector(".popup__button"),D=b.querySelector(".popup__button"),P=I.querySelector(".popup__button");function U(e,t){h.src=e,h.alt=t,S.textContent=t,c(m)}Promise.all([fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/users/me",{headers:e.headers}).then(t),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards",{headers:e.headers}).then(t)]).then((function(e){var t,o,n=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c,a,u=[],i=!0,l=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(t,o)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?d(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=n[0],a=n[1],u=c._id;E.textContent=c.name,w.textContent=c.about,x.style.backgroundImage="url(".concat(c.avatar,")"),a.forEach((function(e){var t=r(e.name,e.link,{handleImageClick:U,likes:e.likes,ownerId:e.owner._id,cardId:e._id,currentUserId:u});p.prepend(t)}))})).catch(console.log),v.addEventListener("click",(function(){c(f)}));var N=document.querySelectorAll(".popup");N.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){a(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&a(e)}))})),k.addEventListener("submit",(function(o){o.preventDefault();var n,r,c=O.textContent;O.textContent="Сохранение...",(n=C.value,r=L.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/users/me",{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then(t)).then((function(e){E.textContent=e.name,w.textContent=e.about,a(_)})).catch(console.log).finally((function(){O.textContent=c}))})),y.addEventListener("click",(function(){C.value=E.textContent,L.value=w.textContent,s(k),l(Array.from(k.querySelectorAll(".popup__input")),k.querySelector(".popup__button")),c(_)})),b.addEventListener("submit",(function(o){o.preventDefault();var n,c,u=D.textContent;D.textContent="Сохранение...",(n=q.value,c=g.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards",{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:c})}).then(t)).then((function(e){var t=r(e.name,e.link,{handleImageClick:U,likes:e.likes,ownerId:e.owner._id,cardId:e._id,currentUserId:e.owner._id});p.prepend(t),b.reset(),s(b),a(f)})).catch(console.log).finally((function(){D.textContent=u}))})),I.addEventListener("submit",(function(e){e.preventDefault();var t=P.textContent;P.textContent="Сохранение...",o(T.value).then((function(e){x.style.backgroundImage="url(".concat(e.avatar,")"),a(A),formAvatar.reset(),s(formAvatar)})).catch(console.log).finally((function(){P.textContent=t}))})),N.forEach((function(e){e.classList.add("popup_is-animated")})),j.addEventListener("click",(function(){T.value="",s(I),l(Array.from(I.querySelectorAll(".popup__input")),I.querySelector(".popup__button")),c(A)})),I.addEventListener("submit",(function(e){e.preventDefault(),o(T.value).then((function(e){x.style.backgroundImage="url(".concat(e.avatar,")"),a(A)})).catch(console.log)})),document.querySelectorAll(".popup__form").forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");l(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){if(["name","description","place-name"].includes(t.name))if(/^[А-Яа-яЁёA-Za-z -]+$/.test(t.value))t.setCustomValidity("");else{var o=t.dataset.errorMessage||"Разрешены только буквы, дефисы и пробелы";t.setCustomValidity(o)}else t.setCustomValidity("");t.validity.valid?i(e,t):function(e,t){var o=e.querySelector(".".concat(t.classList[1],"-error"));t.classList.add("popup__input_type_error"),o.textContent=t.validationMessage,o.classList.add("popup__error_visible")}(e,t)}(e,n),l(t,o)}))}))}(e)}))})();